import{_ as f,M as C,x as y,e as i,f as t,p as h,t as n,i as u,g,w as k,F as x,z as w,k as v,v as D,m as P,o,n as M,q as I,s as S}from"./app-DHpn0u2P.js";import{P as B}from"./PricingComparison-COOjKYZ9.js";const F={name:"Billing",components:{PricingComparison:B},data(){return{products:[{id:"matchmaker_intro",name:"Matchmaker Intro",description:"1 on 1 Connectyed Team Call",originalPrice:5e3,discountedPrice:2500,stripePriceId:"price_1Q6dwmFZef913bMWLjDn3QTZ",rank:0},{id:"silver_package",name:"Silver Package",description:"1 on 1 Blind Date - Choose up to 4 criteria",originalPrice:9900,discountedPrice:5e3,stripePriceId:"price_1Q6dwmFZef913bMWLjDn3QTZ",rank:1},{id:"gold_package",name:"Gold Package",description:"1 on 1 Curated Date - Includes Matchmaker Call",originalPrice:24900,discountedPrice:14900,stripePriceId:"price_1QEIiBFZef913bMWY56u5lcS",rank:2},{id:"platinum_package",name:"Platinum Package",description:"1 on 1 Premium Date - Includes Matchmaker Call",originalPrice:49900,discountedPrice:24900,stripePriceId:"price_1QEIjGFZef913bMWMV75AZ1n",rank:3}],processing:!1,showDiscountModal:!1,selectedProduct:null,discountCode:""}},computed:{...C({user:e=>e.auth.user,authorization:e=>e.auth.authorization}),hasPackage(){var e;return!!((e=this.user)!=null&&e.purchased_package)},userCriteriaCount(){var e;if(!((e=this.user)!=null&&e.criteria))return 0;try{return JSON.parse(this.user.criteria).length}catch(s){return console.error("Error parsing criteria:",s),0}},availableProducts(){if(!this.hasPackage)return this.products;const e=this.getPackageRank(this.user.purchased_package);return this.products.filter(s=>this.getPackageRank(s.id)>=e)}},methods:{formatPackageName(e){return e?e.charAt(0).toUpperCase()+e.slice(1):""},formatDate(e){return e?new Date(e).toLocaleDateString():""},getPackageRank(e){if(!e)return 0;const s=this.products.find(c=>c.id===e||c.id===`${e}_package`);return s?s.rank:0},canPurchasePackage(e){if(!this.hasPackage)return!0;if(this.isCurrentPackage(e))return!1;const s=this.getPackageRank(this.user.purchased_package);return this.getPackageRank(e)>s},isCurrentPackage(e){if(!this.hasPackage)return!1;const s=e.replace("_package","");return this.user.purchased_package===s},getButtonText(e){return this.isCurrentPackage(e)?"Current Package":this.canPurchasePackage(e)?this.hasPackage?"Upgrade":"Purchase":"Lower Tier"},buttonLabel(e){return`${this.hasPackage?"Upgrade to":"Purchase"} ${e.name}`},openDiscountModal(e){this.selectedProduct=e,this.showDiscountModal=!0},closeDiscountModal(){this.showDiscountModal=!1,this.selectedProduct=null,this.discountCode=""},async confirmPurchase(){var e,s;if(this.selectedProduct){this.processing=!0;try{const c={product_type:this.selectedProduct.id,price_id:this.selectedProduct.stripePriceId,discount_code:this.discountCode||null},d=await y.post("/api/billing/create-checkout-session",c,{headers:{Authorization:`Bearer ${this.authorization.token}`}});d.data.success&&d.data.checkout_url?(d.data.is_first_purchase&&localStorage.setItem("redirect_after_payment","/client/criteria"),window.location.href=d.data.checkout_url):(console.error("Failed to create checkout session:",d.data.message),alert(d.data.message||"Failed to create checkout session. Please try again."))}catch(c){console.error("Error creating checkout session:",c),(s=(e=c.response)==null?void 0:e.data)!=null&&s.message?alert(`Error: ${c.response.data.message}`):alert("An unexpected error occurred. Please try again later.")}finally{this.processing=!1,this.closeDiscountModal()}}}},watch:{user:{immediate:!0,handler(e){e!=null&&e.purchased_package||this.$router.push("/client/billing")}}},created(){if(new URLSearchParams(window.location.search).get("session_id")){const c=localStorage.getItem("redirect_after_payment");c&&(localStorage.removeItem("redirect_after_payment"),this.$store.dispatch("auth/getUser").then(()=>{this.$router.push(c)}).catch(d=>{console.error("Error refreshing user data after payment:",d),this.$router.push("/client/billing")}))}}},p=e=>(I("data-v-c02221c0"),e=e(),S(),e),R={class:"container mx-auto p-4"},E={key:0,class:"mb-8 bg-white p-6 rounded-lg shadow"},j=p(()=>t("h2",{class:"text-xl font-bold mb-4"},"Current Package",-1)),L={class:"flex justify-between items-center"},N={class:"text-lg"},T={class:"text-sm text-gray-600 ml-2"},z={class:"text-gray-600 mt-2"},Z={key:0,class:"ml-2"},Q={key:1,class:"mb-8 bg-white p-6 rounded-lg shadow"},U={class:"flex justify-between items-center"},V=p(()=>t("h2",{class:"text-xl font-bold"},"Match Criteria",-1)),A={class:"text-gray-600 mt-2"},W={key:0,class:"ml-2"},Y={key:0},G={key:1},q={class:"mb-6"},J={class:"text-xl font-bold mb-2"},O={key:0,class:"text-gray-600"},H={key:1,class:"text-gray-600"},K={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-2 gap-6 mt-6"},X={key:0,class:"absolute top-0 right-0 bg-blue-500 text-white px-3 py-1 rounded-bl"},$={class:"text-lg font-semibold mb-2"},ee={class:"text-gray-700 mb-4"},te={class:"text-xl font-bold mb-2"},ae={class:"line-through text-gray-500"},se={class:"text-green-600"},re=["onClick","disabled","aria-label"],ie={key:0},oe={key:1},ce={key:2,class:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50","aria-modal":"true",role:"dialog","aria-labelledby":"discount-code-modal-title"},ne={class:"bg-white p-6 rounded-lg shadow-lg w-80"},de=p(()=>t("h3",{id:"discount-code-modal-title",class:"text-lg font-semibold mb-4"},"Enter Discount Code",-1)),le={class:"flex justify-end"},ue=["disabled"],he={key:0},ge={key:1};function pe(e,s,c,d,l,a){const _=P("router-link"),b=P("PricingComparison");return o(),i("div",R,[a.hasPackage?(o(),i("div",E,[j,t("div",L,[t("div",null,[t("p",N,[h(n(a.formatPackageName(e.user.purchased_package))+" Package ",1),t("span",T," (Purchased "+n(a.formatDate(e.user.package_purchased_at))+") ",1)]),t("p",z,[h(" Criteria limit: "+n(e.user.criteria_limit)+" ",1),a.userCriteriaCount!==null?(o(),i("span",Z," ("+n(a.userCriteriaCount)+" used) ",1)):u("",!0)])]),g(_,{to:"/client/criteria",class:"px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 transition duration-200","aria-label":"Manage Criteria"},{default:k(()=>[h(" Manage Criteria ")]),_:1})])])):u("",!0),a.hasPackage?(o(),i("div",Q,[t("div",U,[t("div",null,[V,t("p",A,[h(" Set your match preferences to find your perfect match! "),a.userCriteriaCount>0?(o(),i("span",W," ("+n(a.userCriteriaCount)+"/"+n(e.user.criteria_limit)+" criteria set) ",1)):u("",!0)])]),g(_,{to:"/client/criteria",class:"px-6 py-3 bg-green-500 text-white rounded-lg hover:bg-green-600 transition duration-200 flex items-center space-x-2","aria-label":"Set or Update Match Criteria"},{default:k(()=>[a.userCriteriaCount>0?(o(),i("span",Y,"Update Criteria")):(o(),i("span",G,"Set Your Criteria"))]),_:1})])])):u("",!0),t("div",q,[t("h2",J,n(a.hasPackage?"Upgrade Your Package":"Dating Packages")+"fmatch ",1),a.hasPackage?(o(),i("p",O," Upgrade to get access to more criteria and better matches! ")):(o(),i("p",H," Choose a package to start your dating journey! "))]),g(b),t("div",K,[(o(!0),i(x,null,w(a.availableProducts,r=>{var m;return o(),i("div",{key:r.id,class:"bg-white p-6 rounded-lg shadow relative"},[a.isCurrentPackage(r.id)?(o(),i("div",X," Current ")):u("",!0),t("h3",$,n(r.name),1),t("p",ee,n(r.description),1),t("p",te,[t("span",ae," $"+n((r.originalPrice/100).toFixed(2)),1),t("span",se," $"+n((r.discountedPrice/100).toFixed(2)),1)]),t("button",{onClick:_e=>a.openDiscountModal(r),disabled:!a.canPurchasePackage(r.id)||l.processing,class:M(["w-full py-2 px-4 rounded transition duration-200",a.isCurrentPackage(r.id)?"bg-gray-300 cursor-not-allowed":"bg-blue-500 hover:bg-blue-600 text-white"]),"aria-label":a.buttonLabel(r)},[l.processing&&((m=l.selectedProduct)==null?void 0:m.id)===r.id?(o(),i("span",ie," Processing... ")):(o(),i("span",oe,n(a.getButtonText(r.id)),1))],10,re)])}),128))]),l.showDiscountModal?(o(),i("div",ce,[t("div",ne,[de,v(t("input",{"onUpdate:modelValue":s[0]||(s[0]=r=>l.discountCode=r),type:"text",placeholder:"Discount Code",class:"w-full px-3 py-2 border rounded mb-4","aria-label":"Discount Code"},null,512),[[D,l.discountCode]]),t("div",le,[t("button",{onClick:s[1]||(s[1]=(...r)=>a.closeDiscountModal&&a.closeDiscountModal(...r)),class:"mr-2 px-4 py-2 bg-gray-300 text-gray-700 rounded hover:bg-gray-400","aria-label":"Cancel Discount Code Entry"}," Cancel "),t("button",{onClick:s[2]||(s[2]=(...r)=>a.confirmPurchase&&a.confirmPurchase(...r)),disabled:l.processing,class:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition duration-200 disabled:bg-blue-300","aria-label":"Confirm Discount Code"},[l.processing?(o(),i("span",he,"Processing...")):(o(),i("span",ge,"Confirm"))],8,ue)])])])):u("",!0)])}const Pe=f(F,[["render",pe],["__scopeId","data-v-c02221c0"]]);export{Pe as default};
